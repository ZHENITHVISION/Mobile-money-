<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#00C896">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MMManager">
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAACkklEQVR42u3WAQnAMBAEwfgXEE1x1bp4SHYe1kB6A13LOeecc84559zcnf15BPfOmKdyLjF0MJzBA+GMHgZn9DA4o4fBGT0MzvBBcIYPgjN8EJzhg2D4AsHwBYLxCwLDFwjGLwgMXyAYvyAwfkFg+ALB+AWB8QsC4xcExi8IDF8gGL8gMH5BYPyCwPgFAQACwPgFgfELAuMXBMYvCIxfEAAgAIxfEBi/8gh8LKUR+FDKAvCRlEXg4yiNwIdRFoCPoiwCH0NpBD6EsgB8BKUR+ADKAvD4SiPw8MoC8OhKI/DgygLw2Eoj8NDKAvDISiPwwMoC8LhKI/CwAkAqAvCoSiPwoAJAKgLwmEoj8JACQCoC8IhKI/CAAkAqAvB4SiPwcAJAAkCKAfBoSiPwYAJAAkACQAJASgDwWEoj8FACQAJAAkACQAJAAkACQAJAAkACQAJAuh+ARxIEHkl+gSQAJAAkACQAJAAkACQAJAAkACQAJACk2wFAoPT4ARAAHkwASABIAEgpABAoPX4ABICHEwBSFAAESo8fAAHgAVUGAIHS4wdAAHhIlQFAoPT4ARAAHlRlABAoPX4ABICHVRkABEqPHwDlAUCg9PgBUB4ABEqPHwDlAUCg9PgBUB4ABEqPHwDlAUCg9PgBUB4ABEqPHwLlxw+A8gAgUHr8ECg/fgCUBwCB0uOHQPnxQ6D8+AFQHgAESo8fAuXHD4Hy44dA+fFDoPz4AVAeAARKjx8C5ccPgfLjh0AOBMN3EBi/g8D4HQTG7yAwfgeC4TsIjN9BYPwOBMN3EBi/A8HwHQTG70AwfAeC4TsQDN+BYPgOBMN3IBi+g8HoHQxG72AwetfE4FwKhHMJGM49g8Y555xzzrm5+wE1lErtdTAKJwAAAABJRU5ErkJggg==">
<link rel="manifest" href="data:application/json;charset=utf-8,{%22name%22:%22Mobile Money Manager%22,%22short_name%22:%22MMManager%22,%22description%22:%22Gestion op√©rations Mobile Money%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#0A0F0D%22,%22theme_color%22:%22#00C896%22,%22orientation%22:%22portrait%22,%22icons%22:[{%22src%22:%22data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAACkklEQVR42u3WAQnAMBAEwfgXEE1x1bp4SHYe1kB6A13LOeecc84559zcnf15BPfOmKdyLjF0MJzBA+GMHgZn9DA4o4fBGT0MzvBBcIYPgjN8EJzhg2D4AsHwBYLxCwLDFwjGLwgMXyAYvyAwfkFg+ALB+AWB8QsC4xcExi8IDF8gGL8gMH5BYPyCwPgFAQACwPgFgfELAuMXBMYvCIxfEAAgAIxfEBi/8gh8LKUR+FDKAvCRlEXg4yiNwIdRFoCPoiwCH0NpBD6EsgB8BKUR+ADKAvD4SiPw8MoC8OhKI/DgygLw2Eoj8NDKAvDISiPwwMoC8LhKI/CwAkAqAvCoSiPwoAJAKgLwmEoj8JACQCoC8IhKI/CAAkAqAvB4SiPwcAJAAkCKAfBoSiPwYAJAAkACQAJASgDwWEoj8FACQAJAAkACQAJAAkACQAJAAkACQAJAuh+ARxIEHkl+gSQAJAAkACQAJAAkACQAJAAkACQAJACk2wFAoPT4ARAAHkwASABIAEgpABAoPX4ABICHEwBSFAAESo8fAAHgAVUGAIHS4wdAAHhIlQFAoPT4ARAAHlRlABAoPX4ABICHVRkABEqPHwDlAUCg9PgBUB4ABEqPHwDlAUCg9PgBUB4ABEqPHwDlAUCg9PgBUB4ABEqPHwLlxw+A8gAgUHr8ECg/fgCUBwCB0uOHQPnxQ6D8+AFQHgAESo8fAuXHD4Hy44dA+fFDoPz4AVAeAARKjx8C5ccPgfLjh0AOBMN3EBi/g8D4HQTG7yAwfgeC4TsIjN9BYPwOBMN3EBi/A8HwHQTG70AwfAeC4TsQDN+BYPgOBMN3IBi+g8HoHQxG72AwetfE4FwKhHMJGM49g8Y555xzzrm5+wE1lErtdTAKJwAAAABJRU5ErkJggg==%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22},{%22src%22:%22data:image/png;base64,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%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}]}">
<title>üí∞ Mobile Money Manager</title>
<style>
  :root {
    --green: #00C896;
    --green-dark: #009970;
    --green-light: #E6FFF8;
    --red: #FF4757;
    --orange: #FF9F43;
    --blue: #3B82F6;
    --bg: #0A0F0D;
    --bg2: #111814;
    --bg3: #1A2420;
    --card: #1E2D28;
    --border: #2A3D36;
    --text: #E8F5F0;
    --text2: #8AADA0;
    --text3: #5A7A70;
    --white: #FFFFFF;
    --radius: 16px;
    --radius-sm: 10px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    max-width: 480px;
    margin: 0 auto;
    padding-bottom: 90px;
  }

  /* HEADER */
  .header {
    background: linear-gradient(135deg, #0D1F18 0%, #1A3329 100%);
    padding: 20px 20px 16px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-top { display: flex; align-items: center; justify-content: space-between; }
  .header h1 { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; }
  .header h1 span { color: var(--green); }
  .header-badge {
    background: var(--green);
    color: #000;
    font-size: 10px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 20px;
    letter-spacing: 0.5px;
  }
  .header-date {
    font-size: 12px;
    color: var(--text2);
    margin-top: 4px;
    font-family: 'Courier New', Courier, monospace;
  }

  /* NAV */
  .nav {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 480px;
    background: var(--bg2);
    border-top: 1px solid var(--border);
    display: flex;
    z-index: 100;
    padding: 8px 0 12px;
  }
  .nav-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 6px 4px;
    background: none;
    border: none;
    color: var(--text3);
    font-family: -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 10px;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s;
  }
  .nav-btn .icon { font-size: 22px; }
  .nav-btn.active { color: var(--green); }

  /* PAGES */
  .page { display: none; padding: 16px; }
  .page.active { display: block; }

  /* CARDS */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    margin-bottom: 12px;
  }
  .card-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text2);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  /* STATS ROW */
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
  .stat-card {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px 12px;
  }
  .stat-label { font-size: 10px; color: var(--text3); font-weight: 500; margin-bottom: 4px; }
  .stat-value { font-size: 18px; font-weight: 800; font-family: 'Courier New', Courier, monospace; }
  .stat-value.green { color: var(--green); }
  .stat-value.orange { color: var(--orange); }
  .stat-value.blue { color: var(--blue); }
  .stat-value.red { color: var(--red); }

  /* FORM */
  .form-group { margin-bottom: 14px; }
  .form-label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: var(--text2);
    margin-bottom: 6px;
    letter-spacing: 0.3px;
  }
  .form-label .req { color: var(--green); }
  .form-input, .form-select {
    width: 100%;
    background: var(--bg3);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-family: -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 15px;
    padding: 12px 14px;
    outline: none;
    transition: border-color 0.2s;
    -webkit-appearance: none;
  }
  .form-input:focus, .form-select:focus { border-color: var(--green); }
  .form-select option { background: var(--bg3); }
  .form-input::placeholder { color: var(--text3); }

  /* BUTTONS */
  .btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: var(--radius-sm);
    font-family: -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.3px;
  }
  .btn-primary { background: var(--green); color: #000; }
  .btn-primary:active { background: var(--green-dark); transform: scale(0.98); }
  .btn-danger { background: var(--red); color: #fff; }
  .btn-secondary {
    background: var(--bg3);
    color: var(--text);
    border: 1.5px solid var(--border);
  }

  /* OPERATION TYPES */
  .op-types { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .op-type-btn {
    padding: 12px 8px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--bg3);
    color: var(--text2);
    font-family: -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
  }
  .op-type-btn.selected { border-color: var(--green); background: var(--green-light); color: #000; }

  /* OPERATOR PILLS */
  .operator-pills { display: flex; gap: 8px; flex-wrap: wrap; }
  .operator-pill {
    padding: 8px 14px;
    border: 1.5px solid var(--border);
    border-radius: 20px;
    background: var(--bg3);
    color: var(--text2);
    font-family: -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .operator-pill.selected { border-color: var(--orange); background: #2A1F0A; color: var(--orange); }

  /* LIST ITEMS */
  .op-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }
  .op-item:last-child { border-bottom: none; }
  .op-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .op-icon.depot { background: #0A2018; }
  .op-icon.retrait { background: #200A0A; }
  .op-icon.transfert { background: #0A0A20; }
  .op-icon.paiement { background: #201A0A; }
  .op-info { flex: 1; min-width: 0; }
  .op-name { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .op-meta { font-size: 11px; color: var(--text2); margin-top: 2px; }
  .op-amount { font-size: 14px; font-weight: 700; font-family: 'Courier New', Courier, monospace; white-space: nowrap; }
  .op-amount.depot { color: var(--green); }
  .op-amount.retrait { color: var(--red); }
  .op-amount.transfert { color: var(--blue); }
  .op-amount.paiement { color: var(--orange); }

  /* SEARCH */
  .search-input-wrap { position: relative; margin-bottom: 12px; }
  .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 16px; }
  .search-input { padding-left: 40px !important; }

  /* CLIENT CARD */
  .client-card {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .client-card:active { border-color: var(--green); }
  .client-name { font-size: 15px; font-weight: 700; margin-bottom: 4px; }
  .client-meta { font-size: 12px; color: var(--text2); display: flex; gap: 12px; }
  .client-total { font-family: 'Courier New', Courier, monospace; font-size: 13px; font-weight: 600; color: var(--green); margin-top: 6px; }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 200;
    align-items: flex-end;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 24px 24px 0 0;
    padding: 20px;
    width: 100%;
    max-width: 480px;
    margin: 0 auto;
    max-height: 85vh;
    overflow-y: auto;
  }
  .modal-handle { width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 16px; }
  .modal-title { font-size: 18px; font-weight: 800; margin-bottom: 16px; }

  /* TOAST */
  .toast {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(-20px);
    background: var(--green);
    color: #000;
    padding: 12px 20px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 14px;
    opacity: 0;
    transition: all 0.3s;
    z-index: 300;
    white-space: nowrap;
  }
  .toast.error { background: var(--red); color: #fff; }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* EMPTY STATE */
  .empty {
    text-align: center;
    padding: 40px 20px;
    color: var(--text3);
  }
  .empty-icon { font-size: 48px; margin-bottom: 12px; }
  .empty-text { font-size: 14px; }

  /* DIVIDER */
  .divider { height: 1px; background: var(--border); margin: 12px 0; }

  /* SECTION TITLE */
  .section-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text2);
    letter-spacing: 0.5px;
    text-transform: uppercase;
    margin-bottom: 10px;
    margin-top: 4px;
  }

  /* MONTANT INPUT */
  .montant-wrap { position: relative; }
  .montant-wrap .currency { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); color: var(--text3); font-weight: 600; font-size: 13px; }

  /* QUICK AMOUNTS */
  .quick-amounts { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
  .quick-amt {
    padding: 6px 10px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text2);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    font-family: 'Courier New', Courier, monospace;
  }
  .quick-amt:active { border-color: var(--green); color: var(--green); }

  /* AUTOCOMPLETE */
  .autocomplete-list {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    margin-top: 4px;
    overflow: hidden;
    display: none;
  }
  .autocomplete-list.show { display: block; }
  .autocomplete-item {
    padding: 12px 14px;
    cursor: pointer;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
  }
  .autocomplete-item:last-child { border-bottom: none; }
  .autocomplete-item:active { background: var(--bg3); }
  .autocomplete-item .ac-phone { font-size: 11px; color: var(--text3); margin-top: 2px; }

  /* RAPPORT */
  .rapport-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
  }
  .rapport-row:last-child { border-bottom: none; }
  .rapport-label { font-size: 13px; color: var(--text2); }
  .rapport-val { font-size: 14px; font-weight: 700; font-family: 'Courier New', Courier, monospace; }

  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.5px;
  }
  .badge-green { background: #0A2018; color: var(--green); }
  .badge-red { background: #200A0A; color: var(--red); }
  .badge-blue { background: #0A0A20; color: var(--blue); }
  .badge-orange { background: #201A0A; color: var(--orange); }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="header-top">
    <h1>üí∞ Mobile<span>Money</span></h1>
    <span class="header-badge">OFFLINE</span>
  </div>
  <div class="header-date" id="headerDate"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- PAGE: ACCUEIL -->
<div class="page active" id="page-accueil">
  <!-- BOUTON INSTALLATION -->
  <div id="install-card" style="display:none;background:linear-gradient(135deg,#0D2A1F,#1A3D2A);border:1.5px solid var(--green);border-radius:var(--radius);padding:16px;margin-bottom:12px;display:flex;align-items:center;gap:12px">
    <span style="font-size:32px">üì≤</span>
    <div style="flex:1">
      <div style="font-size:14px;font-weight:700;color:var(--text)">Installer l'application</div>
      <div style="font-size:11px;color:var(--text2);margin-top:2px">Acc√®s direct depuis votre √©cran d'accueil</div>
    </div>
    <button onclick="installerApp()" style="background:var(--green);color:#000;border:none;border-radius:8px;padding:10px 14px;font-weight:700;font-size:13px;cursor:pointer;white-space:nowrap">Installer ‚úì</button>
  </div>

  <!-- GUIDE MANUEL si pas Chrome -->
  <div id="guide-card" style="display:none;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px">
    <div style="font-size:13px;font-weight:700;margin-bottom:8px">üì≤ √âpingler √† l'√©cran d'accueil</div>
    <div style="font-size:12px;color:var(--text2);line-height:1.8">
      <div>1. Appuyez sur les <strong style="color:var(--text)">3 points ‚ãÆ</strong> en haut √† droite</div>
      <div>2. Appuyez sur <strong style="color:var(--text)">"Ajouter √† l'√©cran d'accueil"</strong></div>
      <div>3. Confirmez en appuyant sur <strong style="color:var(--text)">"Ajouter"</strong></div>
    </div>
    <button onclick="document.getElementById('guide-card').style.display='none'" style="margin-top:10px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:8px 14px;color:var(--text2);font-size:12px;cursor:pointer;width:100%">Compris ‚úì</button>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Aujourd'hui</div>
      <div class="stat-value green" id="stat-today-amount">0</div>
      <div class="stat-label" style="margin-top:2px">FCFA</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Op√©rations</div>
      <div class="stat-value blue" id="stat-today-count">0</div>
      <div class="stat-label" style="margin-top:2px">ce jour</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Clients</div>
      <div class="stat-value orange" id="stat-clients">0</div>
      <div class="stat-label" style="margin-top:2px">enregistr√©s</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Ce mois</div>
      <div class="stat-value green" id="stat-month-amount">0</div>
      <div class="stat-label" style="margin-top:2px">FCFA</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">‚ö° Op√©rations r√©centes</div>
    <div id="recent-ops-list">
      <div class="empty"><div class="empty-icon">üìã</div><div class="empty-text">Aucune op√©ration</div></div>
    </div>
  </div>
</div>

<!-- PAGE: SAISIE -->
<div class="page" id="page-saisie">
  <div class="card">
    <div class="card-title">üìù Nouvelle op√©ration</div>

    <div class="form-group">
      <label class="form-label">Type d'op√©ration <span class="req">*</span></label>
      <div class="op-types">
        <button class="op-type-btn" onclick="selectOp('D√©p√¥t')">üì• D√©p√¥t</button>
        <button class="op-type-btn" onclick="selectOp('Retrait')">üì§ Retrait</button>
        <button class="op-type-btn" onclick="selectOp('Transfert')">‚ÜîÔ∏è Transfert</button>
        <button class="op-type-btn" onclick="selectOp('Paiement')">üí≥ Paiement</button>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Op√©rateur <span class="req">*</span></label>
      <div class="operator-pills">
        <button class="operator-pill" onclick="selectOp2('Orange')">üü† Orange</button>
        <button class="operator-pill" onclick="selectOp2('Moov')">üîµ Moov</button>
        <button class="operator-pill" onclick="selectOp2('Telecel')">üü¢ Telecel</button>
        <button class="operator-pill" onclick="selectOp2('Wave')">üåä Wave</button>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">T√©l√©phone client <span class="req">*</span></label>
      <input class="form-input" id="input-phone" type="tel" placeholder="Ex: 70000000" oninput="onPhoneInput(this.value)" autocomplete="off">
      <div class="autocomplete-list" id="autocomplete-list"></div>
    </div>

    <div class="form-group">
      <label class="form-label">Nom complet <span class="req">*</span></label>
      <input class="form-input" id="input-nom" type="text" placeholder="Ex: Moussa Traor√©">
    </div>

    <div class="form-group" id="new-client-fields">
      <label class="form-label">N¬∞ CNI / Pi√®ce d'identit√© <span style="color:var(--text3);font-weight:400">(facultatif)</span></label>
      <input class="form-input" id="input-cni" type="text" placeholder="Ex: B1234567">
    </div>

    <div class="form-group">
      <label class="form-label">Montant (FCFA) <span class="req">*</span></label>
      <div class="montant-wrap">
        <input class="form-input" id="input-montant" type="number" placeholder="0" style="padding-right:60px">
        <span class="currency">FCFA</span>
      </div>
      <div class="quick-amounts">
        <button class="quick-amt" onclick="setMontant(1000)">1 000</button>
        <button class="quick-amt" onclick="setMontant(2000)">2 000</button>
        <button class="quick-amt" onclick="setMontant(5000)">5 000</button>
        <button class="quick-amt" onclick="setMontant(10000)">10 000</button>
        <button class="quick-amt" onclick="setMontant(25000)">25 000</button>
        <button class="quick-amt" onclick="setMontant(50000)">50 000</button>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">R√©f√©rence (optionnel)</label>
      <input class="form-input" id="input-ref" type="text" placeholder="Ex: TXN123456">
    </div>

    <button class="btn btn-primary" id="btn-enregistrer" onclick="enregistrerOp()">‚úÖ Enregistrer l'op√©ration</button>
  </div>
</div>

<!-- PAGE: CLIENTS -->
<div class="page" id="page-clients">
  <div class="search-input-wrap">
    <span class="search-icon">üîç</span>
    <input class="form-input search-input" id="search-client" type="text" placeholder="Rechercher un client..." oninput="rechercherClient(this.value)">
  </div>
  <div id="clients-list"></div>
</div>

<!-- PAGE: RAPPORT -->
<div class="page" id="page-rapport">
  <div class="card">
    <div class="card-title">üìÖ P√©riode</div>
    <div style="display:flex;gap:8px;margin-bottom:12px">
      <button class="btn btn-secondary" style="font-size:13px;padding:10px" onclick="setRapportPeriode('jour')">Aujourd'hui</button>
      <button class="btn btn-secondary" style="font-size:13px;padding:10px" onclick="setRapportPeriode('semaine')">7 jours</button>
      <button class="btn btn-secondary" style="font-size:13px;padding:10px" onclick="setRapportPeriode('mois')">Ce mois</button>
    </div>
    <div id="rapport-content"></div>
  </div>

  <div class="card">
    <div class="card-title">üóÇÔ∏è Donn√©es</div>
    <button class="btn btn-secondary" style="margin-bottom:8px" onclick="exporterDonnees()">üì§ Exporter (JSON)</button>
    <button class="btn btn-secondary" style="margin-bottom:8px" onclick="exporterCSV()">üìä Exporter (CSV / Excel)</button>
    <button class="btn btn-danger" onclick="confirmerSuppression()">üóëÔ∏è Effacer toutes les donn√©es</button>
  </div>
</div>

<!-- √âCRAN ACTIVATION -->
<div id="activation-screen" style="display:none;position:fixed;inset:0;background:var(--bg);z-index:999;flex-direction:column;align-items:center;justify-content:center;padding:24px;text-align:center">
  <div style="font-size:56px;margin-bottom:16px">üîê</div>
  <h2 style="font-size:22px;font-weight:800;margin-bottom:8px">Activation requise</h2>
  <p style="color:var(--text2);font-size:14px;margin-bottom:28px;line-height:1.5">Entrez votre num√©ro et la cl√© re√ßue apr√®s paiement.</p>
  <div style="width:100%;max-width:360px">
    <div class="form-group"><label class="form-label">Num√©ro de t√©l√©phone</label><input class="form-input" id="act-phone" type="tel" placeholder="Ex: 70123456" style="text-align:center;font-size:18px;letter-spacing:2px"></div>
    <div class="form-group"><label class="form-label">Cl√© d'activation</label><input class="form-input" id="act-key" type="text" placeholder="MMK-XXXX-XXXX" style="text-align:center;font-size:16px;letter-spacing:2px;text-transform:uppercase" oninput="this.value=this.value.toUpperCase()"></div>
    <button class="btn btn-primary" onclick="activerApp()" style="margin-bottom:12px">üîì Activer l'application</button>
    <p style="font-size:12px;color:var(--text3)">Contactez votre revendeur pour obtenir votre cl√© d'activation.</p>
  </div>
</div>

<!-- NAV -->
<nav class="nav">
  <button class="nav-btn active" onclick="navTo('accueil', this)">
    <span class="icon">üè†</span>Accueil
  </button>
  <button class="nav-btn" onclick="navTo('saisie', this)">
    <span class="icon">‚ûï</span>Saisir
  </button>
  <button class="nav-btn" onclick="navTo('clients', this)">
    <span class="icon">üë•</span>Clients
  </button>
  <button class="nav-btn" onclick="navTo('rapport', this)">
    <span class="icon">üìä</span>Rapport
  </button>
</nav>

<!-- MODAL CLIENT -->
<div class="modal-overlay" id="modal-client">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modal-client-name"></div>
    <div id="modal-client-content"></div>
    <button class="btn btn-secondary" style="margin-top:12px" onclick="fermerModal()">Fermer</button>
  </div>
</div>

<script>
// ===== DATA =====
let DB = {
  operations: [],
  clients: {}
};

function chargerDB() {
  try {
    const saved = localStorage.getItem('mmm_db');
    if (saved) DB = JSON.parse(saved);
  } catch(e) {}
}

function sauvegarderDB() {
  try {
    localStorage.setItem('mmm_db', JSON.stringify(DB));
  } catch(e) {
    showToast('Erreur: stockage plein', true);
  }
}

// ===== STATE =====
let selectedOp = null;
let selectedOp2 = null;
let selectedPhone = null;
let selectedClientNom = null;
let rapportPeriode = 'jour';

// ===== NAV =====
function navTo(page, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  btn.classList.add('active');

  if (page === 'accueil') rafraichirAccueil();
  if (page === 'clients') rafraichirClients();
  if (page === 'rapport') setRapportPeriode(rapportPeriode);
}

// ===== HEADER =====
function initHeader() {
  const now = new Date();
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  document.getElementById('headerDate').textContent = now.toLocaleDateString('fr-FR', options);
}

// ===== TOAST =====
function showToast(msg, isError = false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (isError ? ' error' : '') + ' show';
  setTimeout(() => t.className = 'toast', 2500);
}

// ===== FORMAT =====
function formatFCFA(n) {
  return Number(n).toLocaleString('fr-FR') + ' FCFA';
}

function formatDate(ts) {
  return new Date(ts).toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: '2-digit' });
}

function formatHeure(ts) {
  return new Date(ts).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
}

function opIcon(type) {
  const icons = { 'D√©p√¥t': 'üì•', 'Retrait': 'üì§', 'Transfert': '‚ÜîÔ∏è', 'Paiement': 'üí≥' };
  return icons[type] || 'üí∞';
}

function opClass(type) {
  const classes = { 'D√©p√¥t': 'depot', 'Retrait': 'retrait', 'Transfert': 'transfert', 'Paiement': 'paiement' };
  return classes[type] || 'depot';
}

// ===== SAISIE =====
function selectOp(type) {
  selectedOp = type;
  document.querySelectorAll('.op-type-btn').forEach(b => {
    b.classList.toggle('selected', b.textContent.includes(type));
  });
}

function selectOp2(op) {
  selectedOp2 = op;
  document.querySelectorAll('.operator-pill').forEach(b => {
    b.classList.toggle('selected', b.textContent.includes(op));
  });
}

function setMontant(v) {
  document.getElementById('input-montant').value = v;
}

function onPhoneInput(val) {
  const list = document.getElementById('autocomplete-list');
  selectedPhone = null;
  selectedClientNom = null;
  document.getElementById('input-nom').readOnly = false;
  document.getElementById('input-cni').readOnly = false;
  document.getElementById('input-nom').style.opacity = '1';
  document.getElementById('input-cni').style.opacity = '1';

  if (val.length < 2) {
    list.classList.remove('show');
    return;
  }

  const matches = Object.values(DB.clients).filter(c =>
    c.telephone.includes(val) || c.nom.toLowerCase().includes(val.toLowerCase())
  ).slice(0, 5);

  if (matches.length > 0) {
    list.innerHTML = matches.map(c =>
      `<div class="autocomplete-item" onclick="selectClient('${c.telephone}','${c.nom.replace(/'/g,"\\'")}','${(c.cni||'').replace(/'/g,"\\'")}')">
        <div>${c.nom}</div>
        <div class="ac-phone">${c.telephone} ${c.cni ? '¬∑ CNI: ' + c.cni : ''}</div>
      </div>`
    ).join('');
    list.classList.add('show');
  } else {
    list.classList.remove('show');
  }
}

function selectClient(phone, nom, cni) {
  selectedPhone = phone;
  selectedClientNom = nom;
  document.getElementById("input-phone").value = phone;
  document.getElementById("input-nom").value = nom;
  document.getElementById("input-cni").value = cni || "";
  document.getElementById("input-nom").readOnly = true;
  document.getElementById("input-cni").readOnly = true;
  document.getElementById("input-nom").style.opacity = "0.6";
  document.getElementById("input-cni").style.opacity = "0.6";
  document.getElementById("autocomplete-list").classList.remove("show");
}

function resetForm() {
  selectedOp = null;
  selectedOp2 = null;
  selectedPhone = null;
  selectedClientNom = null;
  document.querySelectorAll('.op-type-btn').forEach(b => b.classList.remove('selected'));
  document.querySelectorAll('.operator-pill').forEach(b => b.classList.remove('selected'));
  document.getElementById('input-phone').value = '';
  document.getElementById('input-nom').value = '';
  document.getElementById("input-nom").readOnly = false;
  document.getElementById("input-cni").readOnly = false;
  document.getElementById("input-nom").style.opacity = "1";
  document.getElementById("input-cni").style.opacity = "1";
  document.getElementById('input-cni').value = '';
  document.getElementById('input-montant').value = '';
  document.getElementById('input-ref').value = '';
  document.getElementById('autocomplete-list').classList.remove('show');
}

function enregistrerOp() {
  const phone = document.getElementById('input-phone').value.trim();
  const montant = parseFloat(document.getElementById('input-montant').value);
  const ref = document.getElementById('input-ref').value.trim();

  if (!selectedOp) return showToast('‚ö†Ô∏è Choisir le type d\'op√©ration', true);
  if (!selectedOp2) return showToast('‚ö†Ô∏è Choisir l\'op√©rateur', true);
  if (!phone) return showToast('‚ö†Ô∏è Entrer le t√©l√©phone', true);
  if (!montant || montant <= 0) return showToast('‚ö†Ô∏è Entrer un montant valide', true);

  let clientKey = phone;
  let nomClient = selectedClientNom;

  if (!DB.clients[clientKey]) {
    const nom = document.getElementById('input-nom').value.trim();
    const cni = document.getElementById('input-cni').value.trim();
    if (!nom) return showToast('‚ö†Ô∏è Entrer le nom du client', true);
    DB.clients[clientKey] = { telephone: phone, nom, cni, createdAt: Date.now() };
    nomClient = nom;
  }

  const op = {
    id: Date.now(),
    timestamp: Date.now(),
    type: selectedOp,
    operateur: selectedOp2,
    telephone: phone,
    nom: DB.clients[clientKey].nom,
    montant,
    reference: ref
  };

  DB.operations.unshift(op);
  sauvegarderDB();
  showToast('‚úÖ Op√©ration enregistr√©e !');
  resetForm();
  rafraichirAccueil();
}

// ===== ACCUEIL =====
function rafraichirAccueil() {
  const today = new Date().toDateString();
  const thisMonth = new Date().toISOString().slice(0, 7);

  const todayOps = DB.operations.filter(o => new Date(o.timestamp).toDateString() === today);
  const monthOps = DB.operations.filter(o => new Date(o.timestamp).toISOString().slice(0, 7) === thisMonth);

  document.getElementById('stat-today-amount').textContent = todayOps.reduce((s, o) => s + o.montant, 0).toLocaleString('fr-FR');
  document.getElementById('stat-today-count').textContent = todayOps.length;
  document.getElementById('stat-clients').textContent = Object.keys(DB.clients).length;
  document.getElementById('stat-month-amount').textContent = monthOps.reduce((s, o) => s + o.montant, 0).toLocaleString('fr-FR');

  const recentList = document.getElementById('recent-ops-list');
  const recent = DB.operations.slice(0, 15);

  if (recent.length === 0) {
    recentList.innerHTML = '<div class="empty"><div class="empty-icon">üìã</div><div class="empty-text">Aucune op√©ration</div></div>';
    return;
  }

  recentList.innerHTML = recent.map(o => `
    <div class="op-item">
      <div class="op-icon ${opClass(o.type)}">${opIcon(o.type)}</div>
      <div class="op-info">
        <div class="op-name">${o.nom}</div>
        <div class="op-meta">${o.operateur} ¬∑ ${formatDate(o.timestamp)} ${formatHeure(o.timestamp)}</div>
      </div>
      <div style="display:flex;align-items:center;gap:6px">
        <div class="op-amount ${opClass(o.type)}">${o.montant.toLocaleString('fr-FR')}</div>
        <button onclick="modifierOperation(${o.id})" style="background:none;border:none;font-size:15px;cursor:pointer;padding:4px">‚úèÔ∏è</button>
        <button onclick="supprimerOperation(${o.id})" style="background:none;border:none;font-size:15px;cursor:pointer;padding:4px">üóëÔ∏è</button>
      </div>
    </div>
  `).join('');
}

// ===== CLIENTS =====
function rafraichirClients(filtre = '') {
  const list = document.getElementById('clients-list');
  let clients = Object.values(DB.clients);

  if (filtre) {
    clients = clients.filter(c =>
      c.nom.toLowerCase().includes(filtre.toLowerCase()) ||
      c.telephone.includes(filtre)
    );
  }

  if (clients.length === 0) {
    list.innerHTML = '<div class="empty"><div class="empty-icon">üë•</div><div class="empty-text">Aucun client trouv√©</div></div>';
    return;
  }

  list.innerHTML = clients.map(c => {
    const ops = DB.operations.filter(o => o.telephone === c.telephone);
    const total = ops.reduce((s, o) => s + o.montant, 0);
    return `
      <div class="client-card" onclick="voirClient('${c.telephone}')">
        <div class="client-name">${c.nom}</div>
        <div class="client-meta">
          <span>üì± ${c.telephone}</span>
          ${c.cni ? '<span>ü™™ ' + c.cni + '</span>' : ''}
          <span>üìã ${ops.length} op.</span>
        </div>
        <div class="client-total">${total.toLocaleString('fr-FR')} FCFA cumul√©s</div>
      </div>
    `;
  }).join('');
}

function rechercherClient(val) {
  rafraichirClients(val);
}

function voirClient(phone) {
  const client = DB.clients[phone];
  if (!client) return;

  const ops = DB.operations.filter(o => o.telephone === phone);
  const total = ops.reduce((s, o) => s + o.montant, 0);

  document.getElementById('modal-client-name').textContent = client.nom;
  document.getElementById('modal-client-content').innerHTML = `
    <div class="rapport-row">
      <span class="rapport-label">üì± T√©l√©phone</span>
      <span class="rapport-val">${client.telephone}</span>
    </div>
    ${client.cni ? `<div class="rapport-row"><span class="rapport-label">ü™™ CNI</span><span class="rapport-val">${client.cni}</span></div>` : ''}
    <div class="rapport-row">
      <span class="rapport-label">üìã Nb op√©rations</span>
      <span class="rapport-val">${ops.length}</span>
    </div>
    <div class="rapport-row">
      <span class="rapport-label">üí∞ Total cumul√©</span>
      <span class="rapport-val" style="color:var(--green)">${total.toLocaleString('fr-FR')} FCFA</span>
    </div>
    <div class="divider"></div>
    <div class="section-title">Historique</div>
    ${ops.length === 0 ? '<div class="empty-text" style="color:var(--text3)">Aucune op√©ration</div>' :
      ops.slice(0, 20).map(o => `
        <div class="op-item">
          <div class="op-icon ${opClass(o.type)}">${opIcon(o.type)}</div>
          <div class="op-info">
            <div class="op-name">${o.type} ¬∑ ${o.operateur}</div>
            <div class="op-meta">${formatDate(o.timestamp)} √† ${formatHeure(o.timestamp)}</div>
          </div>
          <div style="display:flex;align-items:center;gap:6px">
            <div class="op-amount ${opClass(o.type)}">${o.montant.toLocaleString('fr-FR')}</div>
            <button onclick="fermerModal();modifierOperation(${o.id})" style="background:none;border:none;font-size:15px;cursor:pointer;padding:4px">‚úèÔ∏è</button>
            <button onclick="supprimerOperation(${o.id})" style="background:none;border:none;font-size:15px;cursor:pointer;padding:4px">üóëÔ∏è</button>
          </div>
        </div>
      `).join('')
    }
  `;

  document.getElementById('modal-client').classList.add('open');
}

function fermerModal() {
  document.getElementById('modal-client').classList.remove('open');
}

// ===== RAPPORT =====
function setRapportPeriode(periode) {
  rapportPeriode = periode;
  const now = new Date();
  let ops;

  if (periode === 'jour') {
    ops = DB.operations.filter(o => new Date(o.timestamp).toDateString() === now.toDateString());
  } else if (periode === 'semaine') {
    const il7j = now.getTime() - 7 * 24 * 60 * 60 * 1000;
    ops = DB.operations.filter(o => o.timestamp >= il7j);
  } else {
    const thisMonth = now.toISOString().slice(0, 7);
    ops = DB.operations.filter(o => new Date(o.timestamp).toISOString().slice(0, 7) === thisMonth);
  }

  const total = ops.reduce((s, o) => s + o.montant, 0);
  const depots = ops.filter(o => o.type === 'D√©p√¥t');
  const retraits = ops.filter(o => o.type === 'Retrait');
  const transferts = ops.filter(o => o.type === 'Transfert');
  const paiements = ops.filter(o => o.type === 'Paiement');

  const byOp = {};
  ops.forEach(o => {
    byOp[o.operateur] = (byOp[o.operateur] || 0) + o.montant;
  });

  document.getElementById('rapport-content').innerHTML = `
    <div class="rapport-row">
      <span class="rapport-label">Total op√©rations</span>
      <span class="rapport-val">${ops.length}</span>
    </div>
    <div class="rapport-row">
      <span class="rapport-label">Volume total</span>
      <span class="rapport-val" style="color:var(--green)">${total.toLocaleString('fr-FR')} FCFA</span>
    </div>
    <div class="divider"></div>
    <div class="rapport-row">
      <span class="rapport-label">üì• D√©p√¥ts</span>
      <span class="rapport-val">${depots.length} ¬∑ ${depots.reduce((s,o)=>s+o.montant,0).toLocaleString('fr-FR')}</span>
    </div>
    <div class="rapport-row">
      <span class="rapport-label">üì§ Retraits</span>
      <span class="rapport-val">${retraits.length} ¬∑ ${retraits.reduce((s,o)=>s+o.montant,0).toLocaleString('fr-FR')}</span>
    </div>
    <div class="rapport-row">
      <span class="rapport-label">‚ÜîÔ∏è Transferts</span>
      <span class="rapport-val">${transferts.length} ¬∑ ${transferts.reduce((s,o)=>s+o.montant,0).toLocaleString('fr-FR')}</span>
    </div>
    <div class="rapport-row">
      <span class="rapport-label">üí≥ Paiements</span>
      <span class="rapport-val">${paiements.length} ¬∑ ${paiements.reduce((s,o)=>s+o.montant,0).toLocaleString('fr-FR')}</span>
    </div>
    ${Object.keys(byOp).length > 0 ? `
    <div class="divider"></div>
    <div class="section-title" style="margin-top:8px">Par op√©rateur</div>
    ${Object.entries(byOp).map(([op, total]) => `
      <div class="rapport-row">
        <span class="rapport-label">${op}</span>
        <span class="rapport-val">${total.toLocaleString('fr-FR')} FCFA</span>
      </div>
    `).join('')}` : ''}
  `;
}

// ===== EXPORT =====
function exporterDonnees() {
  const data = JSON.stringify(DB, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'mobilemoney_backup_' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  showToast('‚úÖ Donn√©es export√©es !');
}

function confirmerSuppression() {
  if (confirm('‚ö†Ô∏è Effacer TOUTES les donn√©es ? Cette action est irr√©versible !')) {
    DB = { operations: [], clients: {} };
    sauvegarderDB();
    rafraichirAccueil();
    showToast('Donn√©es effac√©es');
  }
}


// ===== MODIFIER / SUPPRIMER =====
function supprimerOperation(id) {
  if (!confirm('‚ö†Ô∏è Supprimer cette op√©ration ? Action irr√©versible.')) return;
  DB.operations = DB.operations.filter(o => o.id != id);
  sauvegarderDB();
  rafraichirAccueil();
  rafraichirClients();
  showToast('‚úÖ Op√©ration supprim√©e');
  fermerModal();
}

function modifierOperation(id) {
  const op = DB.operations.find(o => o.id == id);
  if (!op) return;
  // Aller sur saisie
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-saisie').classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.nav-btn')[1].classList.add('active');
  // Pr√©-remplir
  selectOp(op.type);
  selectOp2(op.operateur);
  document.getElementById('input-phone').value = op.telephone;
  document.getElementById('input-nom').value = op.nom;
  document.getElementById('input-nom').readOnly = true;
  document.getElementById('input-nom').style.opacity = '0.6';
  const client = DB.clients[op.telephone];
  document.getElementById('input-cni').value = client ? client.cni || '' : '';
  document.getElementById('input-cni').readOnly = true;
  document.getElementById('input-cni').style.opacity = '0.6';
  document.getElementById('input-montant').value = op.montant;
  document.getElementById('input-ref').value = op.reference || '';
  selectedPhone = op.telephone;
  // Changer bouton
  window._editingId = id;
  const btn = document.getElementById('btn-enregistrer');
  btn.textContent = '‚úèÔ∏è Mettre √† jour l\'op√©ration';
  btn.setAttribute('onclick', 'mettreAJourOperation()');
  window.scrollTo(0, 0);
  showToast('Modifiez les champs puis validez');
}

function mettreAJourOperation() {
  const id = window._editingId;
  if (!id) return;
  const montant = parseFloat(document.getElementById('input-montant').value);
  const ref = document.getElementById('input-ref').value.trim();
  if (!selectedOp) return showToast('‚ö†Ô∏è Choisir le type', true);
  if (!selectedOp2) return showToast('‚ö†Ô∏è Choisir l\'op√©rateur', true);
  if (!montant || montant <= 0) return showToast('‚ö†Ô∏è Montant invalide', true);
  const idx = DB.operations.findIndex(o => o.id == id);
  if (idx === -1) return;
  DB.operations[idx] = { ...DB.operations[idx], type: selectedOp, operateur: selectedOp2, montant, reference: ref };
  sauvegarderDB();
  showToast('‚úÖ Op√©ration mise √† jour !');
  window._editingId = null;
  const btn = document.getElementById('btn-enregistrer');
  btn.textContent = '‚úÖ Enregistrer l\'op√©ration';
  btn.setAttribute('onclick', 'enregistrerOp()');
  resetForm();
  rafraichirAccueil();
}

// ===== EXPORT CSV =====
function exporterCSV() {
  if (DB.operations.length === 0) return showToast('Aucune donn√©e', true);
  const headers = ['Date', 'Heure', 'Type', 'Op√©rateur', 'Client', 'T√©l√©phone', 'Montant (FCFA)', 'R√©f√©rence'];
  const rows = DB.operations.map(o => [
    formatDate(o.timestamp), formatHeure(o.timestamp),
    o.type, o.operateur, o.nom, o.telephone, o.montant, o.reference || ''
  ]);
  const csv = [headers, ...rows].map(r => r.map(c => `"${c}"`).join(';')).join('\n');
  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'operations_' + new Date().toISOString().slice(0,10) + '.csv';
  a.click();
  showToast('‚úÖ Export CSV r√©ussi !');
}

// ===== ACTIVATION =====
function genererCle(telephone) {
  const num = telephone.replace(/\D/g, '');
  const seed = parseInt(num) || 0;
  const SECRET = 0x4D4D4B42;
  let h = seed ^ SECRET;
  h = ((h >> 16) ^ h) * 0x45D9F3B;
  h = ((h >> 16) ^ h) * 0x45D9F3B;
  h = (h >> 16) ^ h;
  h = Math.abs(h);
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let part1 = '', part2 = '', tmp = h;
  for (let i = 0; i < 4; i++) { part1 += chars[tmp % chars.length]; tmp = Math.floor(tmp / chars.length); }
  for (let i = 0; i < 4; i++) { part2 += chars[(tmp + i * 7) % chars.length]; tmp = Math.floor(tmp / chars.length) + 1; }
  return `MMK-${part1}-${part2}`;
}

function verifierActivation() {
  const activation = localStorage.getItem('mmm_activation');
  if (!activation) return false;
  try {
    const { telephone, cle } = JSON.parse(activation);
    return cle === genererCle(telephone);
  } catch(e) { return false; }
}

function activerApp() {
  const phone = document.getElementById('act-phone').value.trim();
  const cle = document.getElementById('act-key').value.trim().toUpperCase();
  if (!phone) return showToast('‚ö†Ô∏è Entrez votre num√©ro', true);
  if (!cle) return showToast('‚ö†Ô∏è Entrez la cl√© d\'activation', true);
  if (cle !== genererCle(phone)) return showToast('‚ùå Cl√© incorrecte', true);
  localStorage.setItem('mmm_activation', JSON.stringify({ telephone: phone, cle }));
  document.getElementById('activation-screen').style.display = 'none';
  showToast('‚úÖ Application activ√©e !');
  rafraichirAccueil();
}

function checkActivation() {
  if (!verifierActivation()) {
    document.getElementById('activation-screen').style.display = 'flex';
  }
}

// ===== INIT =====
chargerDB();
initHeader();
checkActivation();
rafraichirAccueil();

// Fermer modal en cliquant dehors
document.getElementById('modal-client').addEventListener('click', function(e) {
  if (e.target === this) fermerModal();
});

// Fermer autocomplete en cliquant dehors
document.addEventListener('click', function(e) {
  if (!e.target.closest('#autocomplete-list') && !e.target.closest('#input-phone')) {
    document.getElementById('autocomplete-list').classList.remove('show');
  }
});
</script>

<script>
// Service Worker offline
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'mmm-v2';
    self.addEventListener('install', e => { e.waitUntil(caches.open(CACHE).then(c => c.addAll(['.']))); self.skipWaiting(); });
    self.addEventListener('fetch', e => { e.respondWith(caches.match(e.request).then(r => r || fetch(e.request).catch(() => caches.match('.')))); });
  `;
  const blob = new Blob([swCode], {type: 'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(() => {});
}

let deferredPrompt = null;

// Chrome/Android : capture l'√©v√©nement d'installation automatique
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  // Afficher le bouton d'installation natif
  const card = document.getElementById('install-card');
  if (card) card.style.display = 'flex';
  // Cacher le guide manuel
  const guide = document.getElementById('guide-card');
  if (guide) guide.style.display = 'none';
});

// App d√©j√† install√©e
window.addEventListener('appinstalled', () => {
  deferredPrompt = null;
  const card = document.getElementById('install-card');
  if (card) card.style.display = 'none';
  showToast('‚úÖ Application install√©e !');
});

function installerApp() {
  if (deferredPrompt) {
    // Chrome : installation automatique
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(choice => {
      deferredPrompt = null;
      const card = document.getElementById('install-card');
      if (card) card.style.display = 'none';
    });
  } else {
    // Autres navigateurs : afficher le guide manuel
    const guide = document.getElementById('guide-card');
    if (guide) guide.style.display = 'block';
    const card = document.getElementById('install-card');
    if (card) card.style.display = 'none';
  }
}

// V√©rifier si pas encore install√© au chargement
window.addEventListener('load', () => {
  const isInstalled = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  if (!isInstalled) {
    // Attendre 1 seconde puis afficher le bouton guide si Chrome n'a pas d√©clench√© beforeinstallprompt
    setTimeout(() => {
      if (!deferredPrompt) {
        const guide = document.getElementById('guide-card');
        if (guide) guide.style.display = 'block';
      }
    }, 1500);
  }
});
</script>

</body>
</html>
